---
layout: post
title: Setting up Debian server from scratch for Django (Nginx, Postresql, Gunicorn,
  Django and Supervisor) - Part IV
date: '2015-07-28T04:12:00.004-07:00'
author: Prabakaran Santhanam
tags: 
modified_time: '2015-07-28T04:12:56.185-07:00'
blogger_id: tag:blogger.com,1999:blog-9128617390470614639.post-8446899214789277094
blogger_orig_url: http://codificious.blogspot.com/2015/07/setting-up-debian-server-from-scratch_79.html
---

###### START OF BACKUP CONFIGURATIN ######<br /><br />1. use crontab,<br /><br />&nbsp;&nbsp;&nbsp; $ crontab -e<br /><br /><br />add the following lines at the end of the file<br /><br />&nbsp;####backup toppers sb everyday########## <br />&nbsp; <br />&nbsp;# m h dom mon dow&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; command&nbsp; <br />&nbsp; <br />&nbsp;&nbsp; 0 0&nbsp; *&nbsp;&nbsp;&nbsp; *&nbsp;&nbsp; *&nbsp;&nbsp; cd /home/toppersdj/db_backup &amp;&amp; ./backup &gt; /dev/null 2&gt;&amp;1 <br /><br /><br />where,<br /><br />&nbsp;# m h dom mon dow&nbsp; command&nbsp; <br /><br /><br />is the format.<br /><br />m - Minute (0-59)<br />h - Hour (0-23)<br />dom - Day of Month (1-31)<br />mon - Month (1-12)<br />dow - Day of week (0-6, starting with Sunday)<br /><br />and the command is the shell command that you want the cron to execute at the specified time.<br /><br />Here in the above example I've asked cron to execute the command<br /><br />&nbsp;cd /home/user/db_backup &amp;&amp; ./backup &gt; /dev/null 2&gt;&amp;1 <br /><br /><br />at every dom, mon and dow. That is what for the '*' is used. So, as everyday starts, cron will run the command I've specified.<br /><br />In  the above command in cron, I've asked cron to execute a shell script  named backup. I've done this in order to declare some variables or  settings needed for backing up the database without complicating the  crontab. It will also be easy to maintain different shell scripts for  backing up different databases with respective configurations.<br /><br />2. In backup file,<br /><br />&nbsp;&nbsp;&nbsp; $ nano /home/user/db_backup/backup<br /><br />&nbsp;#! /bin/bash <br />&nbsp;FILE="/home/user/db_backup/backup_$(date +%Y%m%d_%H%M%S).pgsql" <br />&nbsp;pg_dump --no-password database_name &gt; $FILE <br /><br /><br />I've  created a file name and stored it into FILE variable, then dumped the  database into a new file with name FILE. If you are using openscg or  something, and if that specific environment is not added in the current  environment, then add the following line next to shebang,<br /><br />&nbsp;source /opt/postgres/9.1/pg91-openscg.env # for openscg <br /><br /><br />But, the above setup will end with an error message,<br /><br />&nbsp;&nbsp;&nbsp; pg_dump: [archiver (db)] connection to database 'database_name' failed: fe_sendauth: no password supplied<br /><br /><br />as  there should be a password supplied in order to authenticate a user to  back up the database. As we are automating the backup we can't (I'm not  sure here) enter the password interactively every time. So, we've to  supply the password in some implicit way. Postgresql gives us an option  in the form of a .pgpass file.<br /><br />3. .pgpass file should be created in home directory and it should contain the following details,<br /><br />&nbsp;&nbsp;&nbsp; $ nano ~/.pgpass<br /><br />&nbsp;hostname:port:database:username:password <br /><br />now restart the postgresql and check if the backup works without a password by executing the backup file.<br /><br />$ chmod +x /home/user/db_backup/backup&nbsp; # making 'backup' executable<br />$ /home/user/db_backup/backup<br /><br />This  will backup a database in the db_backup directory or any other  directory you've specified in backup script file with current date and  time. <br /><br />###### END OF BACKUP CONFIGURATIN ######