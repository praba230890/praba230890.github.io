---
layout: post
title: Setting up Debian server from scratch for Django (Nginx, Postresql, Gunicorn,
  Django and Supervisor) - Part III
date: '2015-07-29T05:47:00.000-07:00'
author: Prabakaran Santhanam
tags: 
modified_time: '2015-07-29T05:47:33.470-07:00'
blogger_id: tag:blogger.com,1999:blog-9128617390470614639.post-4788581938671725213
blogger_orig_url: http://codificious.blogspot.com/2015/07/setting-up-debian-server-from-scratch_29.html
---

###### START OF WEB APP CONFIGURATIN ######<br /><br />1. Download and install pip<br /><br />$ wget https://github.com/pypa/pip/raw/develop/contrib/get-pip.py<br /><br />$ python get-pip.py<br /><br />$ pip freeze<br /><br />2. Install virtualenv<br /><br />$ pip install virtualenv<br /><br />3. Create a virtual environment for our project<br /><br />$ mkdir ~/.envs<br /><br />this .envs directory will hold all the virtual envs we are going to create, to have more simple setup install <br />virtualenv wrapper and export it's variables into .bashrc or .zshrc.<br /><br />$ virtualenv ~/.envs/firstproject<br /><br />then activate that environment,<br /><br />$ source ~/.env/firstproject/bin/activate<br /><br />(firstproject)$ <br /><br />4. Install Django and other basic requirements<br /><br />$ pip install django<br /><br />installing without version number via pip will install the latest version available<br /><br />$ pip install psycopg2&nbsp;&nbsp;&nbsp; # postgresql-python binding<br /><br />[<br />To install psycopg2 there might be some build essentials needed,<br /><br />$ apt-get install build-essential autoconf libtool pkg-config python-opengl python-imaging python-pyrex&nbsp; python-dev<br />]<br /><br />$ pip install gunicorn&nbsp;&nbsp;&nbsp; # WSGI server<br /><br />$ pip install requests&nbsp;&nbsp;&nbsp; # not necessary for now, but just installing it<br /><br />5. Create a sample project to test our configurations<br /><br />$ django-admin startproject firstproject<br /><br />$ cd firstproject<br /><br />[some people like to have the virtual environment along with their project. In those cases the virtual environment could be<br />created in the project folder itself like <br /><br />$ virtualenv ~/firstproject/firstproject<br /><br />instead  of creating it in .envs folder in step 3. By doing this way some people  find it easy to maintain projects and virtual envs.]<br /><br />6. Configure the firstproject to use the database we've created in Postgresql<br /><br />open firstproject/setting.py file,<br /><br />[before this step, in practical application development, the first thing to do is configure the time zone ]<br /><br />$ nano firstproject/settings.py<br /><br />under databases section, change it like this<br /><br /># Database<br /># https://docs.djangoproject.com/en/1.8/ref/settings/#databases<br /><br />DATABASES = {<br />&nbsp;&nbsp;&nbsp; 'default': {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'ENGINE': 'django.db.backends.postgresql_psycopg2',<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'NAME': 'database_name',<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'USER': 'role_name',<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'PASSWORD': 'role_password',<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'HOST': '127.0.0.1',<br /><br />&nbsp;&nbsp;&nbsp; }<br />}<br /><br />and save the file.<br /><br />7. Let the django create a schema for out project<br /><br />$ python manage.py migrate<br /><br />8. Once the above step was done, run the project to check if the django is workingfine,<br /><br />$ python manage.py runserver 0.0.0.0:8001<br /><br />and go to your browser on local system and enter the address to check if django works fine (eg: http://server-ip:port)<br /><br />9.  Now, we can't use the runserver in production, instead we are about to  user Gunicorn+Nginx. So, lets first configure Gunicorn.<br />Actually, there is nothing to configure in gunicorn.<br /><br />$ gunicorn firstproject.wsgi --name=firstproject --bind=0.0.0.0:8001 --daemon<br /><br />will run the project just like runserver did, but in deamonized mode. i,e even if I exit the current session, the application<br />would still be running. To kill the application running under gunicorn,<br /><br />$ pkill gunicorn<br /><br />10. By just running under gunicorn, would produce result in browser, but with no static files.<br /><br />Gunicorn combined with Nginx will make our server powerful, as gunicorn will take care of dynamic processing while Nginx will <br />server static files efficiently.<br /><br />So, lets configure Nginx to work with gunicorn<br /><br />$ nano /etc/nginx/sites-enabled/firstproject<br /><br />You could copy /etc/nginx/sites-enabled/default into /etc/nginx/sites-enabled/firstproject<br /><br />or just create the firstproject nginx conf yourself with minimal settings, just add the below server block<br /><br />server{<br />&nbsp;&nbsp;&nbsp; listen 80;<br />&nbsp;&nbsp;&nbsp; server_name IP_ADDRESS;<br /><br />&nbsp;&nbsp;&nbsp; location / {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; proxy_pass http://127.0.0.1:8001;&nbsp;&nbsp; # passing requests to Gunicorn<br />&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp; location /static/ {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  alias /home/username/firstproject/staticfiles/; # conf to serve the  static file, for more info refer django docs on static files<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /><br />}<br /><br />and save the file.<br /><br />Reload Nginx with new conf.<br /><br />$ sudo service nginx reload<br /><br />11. Finally configure your gunicorn with supervisor so that your application will auto restart even if it craches.<br /><br />$ vim /etc/supervisor/conf.d/firstproject.conf<br />[program:tes]<br />command=/home/user/.envs/firstproject/bin/gunicorn firstproject.wsgi --name=firstproject --bind=0.0.0.0:8001<br />directory=/home/user/firstproject/<br />autostart=true<br />autorestart=true<br />stderr_logfile=/var/log/firstproject.err.log<br />stdout_logfile=/var/log/firstproject.out.log<br /><br />and reload the conf file.<br /><br />$ service supervisor restart<br /><br />$ supervisorctl<br />firstproject&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RUNNING&nbsp;&nbsp;&nbsp; pid 11274, uptime 0:00:07<br /><br /><br />###### END OF WEB APP CONFIGURATIN ######