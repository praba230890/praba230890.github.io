---
layout: post
title: Configuing Automatic PostgreSQL Database Backup Using Cron
date: '2015-07-27T23:47:00.000-07:00'
author: Prabakaran Santhanam
tags:
- database
- automatic backup
- backup
- crontab -e
- crontab
- postgresql database backup
- postgresql
modified_time: '2015-07-29T05:40:36.236-07:00'
blogger_id: tag:blogger.com,1999:blog-9128617390470614639.post-7599405578900744828
blogger_orig_url: http://codificious.blogspot.com/2015/07/configuing-automatic-postgresql.html
---

First, use crontab,<br /><br /><blockquote class="tr_bq">$ crontab -e</blockquote><br />add the following lines at the end of the file <br /><pre style="background-image: URL(http://2.bp.blogspot.com/_z5ltvMQPaa8/SjJXr_U2YBI/AAAAAAAAAAM/46OqEP32CJ8/s320/codebg.gif); background: #f0f0f0; border: 1px dashed #CCCCCC; color: black; font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> ####backup toppers sb everyday##########  <br />   <br /> # m h dom mon dow             command   <br />   <br />   0 0  *    *   *   cd /home/user/db_backup &amp;&amp; ./backup &gt; /dev/null 2&gt;&amp;1  <br /></code></pre><br />where,<br /><br /><pre style="background-image: URL(http://2.bp.blogspot.com/_z5ltvMQPaa8/SjJXr_U2YBI/AAAAAAAAAAM/46OqEP32CJ8/s320/codebg.gif); background: #f0f0f0; border: 1px dashed #CCCCCC; color: black; font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> # m h dom mon dow  command   <br /></code></pre><br />is the format.<br /><br />m - Minute (0-59)<br />h - Hour (0-23)<br />dom - Day of Month (1-31)<br />mon - Month (1-12)<br />dow - Day of week (0-6, starting with Sunday)<br /><br />and the command is the shell command that you want the cron to execute at the specified time.<br /><br />Here in the above example I've asked cron to execute the command<br /><br /><pre style="background-image: URL(http://2.bp.blogspot.com/_z5ltvMQPaa8/SjJXr_U2YBI/AAAAAAAAAAM/46OqEP32CJ8/s320/codebg.gif); background: #f0f0f0; border: 1px dashed #CCCCCC; color: black; font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> cd /home/user/db_backup &amp;&amp; ./backup &gt; /dev/null 2&gt;&amp;1  <br /></code></pre><br />at every dom, mon and dow. That is what for the '*' is used. So, as everyday starts, cron will run the command I've specified.<br /><br />In the above command in cron, I've asked cron to execute a shell script named backup. I've done this in order to declare some variables or settings needed for backing up the database without complicating the crontab. It will also be easy to maintain different shell scripts for backing up different databases with respective configurations.<br /><br />In backup file,<br /><blockquote class="tr_bq">$ nano /home/user/db_backup/backup</blockquote><pre style="background-image: URL(http://2.bp.blogspot.com/_z5ltvMQPaa8/SjJXr_U2YBI/AAAAAAAAAAM/46OqEP32CJ8/s320/codebg.gif); background: #f0f0f0; border: 1px dashed #CCCCCC; color: black; font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> #! /bin/bash  <br /> FILE="/home/user/db_backup/backup_$(date +%Y%m%d_%H%M%S).pgsql"  <br /> pg_dump --no-password database_name &gt; $FILE  <br /></code></pre><br />I've created a file name and stored it into FILE variable, then dumped the database into a new file with name FILE. If you are using openscg or something, and if that specific environment is not added in the current environment, then add the following line next to shebang,<br /><br /><pre style="background-image: URL(http://2.bp.blogspot.com/_z5ltvMQPaa8/SjJXr_U2YBI/AAAAAAAAAAM/46OqEP32CJ8/s320/codebg.gif); background: #f0f0f0; border: 1px dashed #CCCCCC; color: black; font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> source /opt/postgres/9.1/pg91-openscg.env # for openscg  <br /></code></pre><br />But, the above setup will end with an error message,<br /><br /><blockquote class="tr_bq"><span style="color: red;">pg_dump: [archiver (db)] connection to database 'database_name' failed: fe_sendauth: no password supplied</span><br /><span style="color: red;"></span></blockquote><br />as there should be a password supplied in order to authenticate a user to back up the database. As we are automating the backup we can't (I'm not sure here) enter the password interactively every time. So, we've to supply the password in some implicit way. Postgresql gives us an option in the form of a .pgpass file. <br /><br />.pgpass file should be created in home directory and it should contain the following details,<br /><blockquote class="tr_bq">$ nano ~/.pgpass</blockquote><pre style="background-image: URL(http://2.bp.blogspot.com/_z5ltvMQPaa8/SjJXr_U2YBI/AAAAAAAAAAM/46OqEP32CJ8/s320/codebg.gif); background: #f0f0f0; border: 1px dashed #CCCCCC; color: black; font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> hostname:port:database:username:password  <br /></code></pre>now restart the postgresql and check if the backup works without a password by executing the backup file.<br /><br />$ chmod +x /home/user/db_backup/backup&nbsp; # making 'backup' executable<br />$ /home/user/db_backup/backup<br /><br />This will backup a database in the db_backup directory or any other directory you've specified in backup script file with current date and time. 